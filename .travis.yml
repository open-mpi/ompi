sudo: required
dist: trusty
language: c
compiler:
    - gcc
os:
    - linux
    - osx

addons:
    apt:
        packages:
            - rpm
            - libnl-3-200
            - libnl-3-dev
            - libnl-route-3-200
            - libnl-route-3-dev
            - autoconf
            - automake
            - libtool
            - libibverbs-dev
            - librdmacm-dev

env:
    global:
        - CPPFLAGS=-I$HOME/include
        - LDFLAGS=-L$HOME/lib
        - LD_LIBRARY_PATH=$HOME/lib
        - CONFIGURE_ARGS="--prefix=$HOME --enable-usnic"
        - CONFIGURE_ARGS="--prefix=$HOME --enable-usnic"

before_install:
    - sudo apt-get update -qq
    - ifconfig

install:
    - m4 --version
    - automake --version
    - autoconf --version
    - libtool --version
    - ./autogen.pl
    - if [[ "$TRAVIS_OS_NAME" == "linux" && "$CC" == "gcc" ]]; then ./configure $CONFIGURE_ARGS --enable-verbs; else ./configure $CONFIGURE_ARGS; fi
    - make -j4
    - make install > /dev/null
script:
    - make check
    - make distcheck

notifications:
  email:
    recipients:
      - jsquyres@cisco.com
    on_success: [change]
    on_failure: [always]

matrix:
  allow_failures:
    - os: osx
